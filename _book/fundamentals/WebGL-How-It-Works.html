
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>WebGL How It Works · GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.0">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="WebGL-Shaders-and-GLSL.html" />
    
    
    <link rel="prev" href="WebGL-Fundamentals.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="./">
            
                <a href="./">
            
                    
                    Fundamentals
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="WebGL-Fundamentals.html">
            
                <a href="WebGL-Fundamentals.html">
            
                    
                    WebGL Fundamentals
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.2" data-path="WebGL-How-It-Works.html">
            
                <a href="WebGL-How-It-Works.html">
            
                    
                    WebGL How It Works
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="WebGL-Shaders-and-GLSL.html">
            
                <a href="WebGL-Shaders-and-GLSL.html">
            
                    
                    WebGL Shaders and GLSL
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../image-processing/">
            
                <a href="../image-processing/">
            
                    
                    Image Processing
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../image-processing/WebGL-Image-Processing.html">
            
                <a href="../image-processing/WebGL-Image-Processing.html">
            
                    
                    WebGL Image Processing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../image-processing/WebGL-Image-Processing-Continued.html">
            
                <a href="../image-processing/WebGL-Image-Processing-Continued.html">
            
                    
                    WebGL Image Processing Continued
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../2D-translation/">
            
                <a href="../2D-translation/">
            
                    
                    2D translation, rotation, scale, matrix math
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../2D-translation/WebGL-2D-Translation.html">
            
                <a href="../2D-translation/WebGL-2D-Translation.html">
            
                    
                    WebGL 2D Translation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../2D-translation/WebGL-2D-Rotation.html">
            
                <a href="../2D-translation/WebGL-2D-Rotation.html">
            
                    
                    WebGL 2D Rotation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../2D-translation/WebGL-2D-Scale.html">
            
                <a href="../2D-translation/WebGL-2D-Scale.html">
            
                    
                    WebGL 2D Scale
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../2D-translation/WebGL-2D-Matrices.html">
            
                <a href="../2D-translation/WebGL-2D-Matrices.html">
            
                    
                    WebGL 2D Matrices
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../3D/">
            
                <a href="../3D/">
            
                    
                    3D
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../3D/WebGL-Orthographic-3D.html">
            
                <a href="../3D/WebGL-Orthographic-3D.html">
            
                    
                    WebGL - Orthographic 3D
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../3D/WebGL-3D-Perspective.html">
            
                <a href="../3D/WebGL-3D-Perspective.html">
            
                    
                    WebGL 3D Perspective
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../3D/WebGL-3D-Cameras.html">
            
                <a href="../3D/WebGL-3D-Cameras.html">
            
                    
                    WebGL 3D - Cameras
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../lighting/">
            
                <a href="../lighting/">
            
                    
                    Lighting
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../lighting/WebGL-3D-Directional-Lighting.html">
            
                <a href="../lighting/WebGL-3D-Directional-Lighting.html">
            
                    
                    WebGL 3D - Directional Lighting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../lighting/WebGL-3D-Point-Lighting.html">
            
                <a href="../lighting/WebGL-3D-Point-Lighting.html">
            
                    
                    WebGL 3D - Point Lighting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../Structure-and-Organization/">
            
                <a href="../Structure-and-Organization/">
            
                    
                    Structure and Organization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../Structure-and-Organization/WebGL-Less-Code-More-Fun.html">
            
                <a href="../Structure-and-Organization/WebGL-Less-Code-More-Fun.html">
            
                    
                    WebGL - Less Code, More Fun
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../Structure-and-Organization/WebGL-Drawing-Multiple-Things.html">
            
                <a href="../Structure-and-Organization/WebGL-Drawing-Multiple-Things.html">
            
                    
                    WebGL - Drawing Multiple Things
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../Structure-and-Organization/WebGL-Scene-Graphs.html">
            
                <a href="../Structure-and-Organization/WebGL-Scene-Graphs.html">
            
                    
                    WebGL - Scene Graphs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../techniques/">
            
                <a href="../techniques/">
            
                    
                    Techniques
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../techniques/WebGL-2D-DrawImage.html">
            
                <a href="../techniques/WebGL-2D-DrawImage.html">
            
                    
                    WebGL 2D - DrawImage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../techniques/WebGL-2D-Matrix-Stack.html">
            
                <a href="../techniques/WebGL-2D-Matrix-Stack.html">
            
                    
                    WebGL 2D - Matrix Stack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../techniques/WebGL-Text-HTML.html">
            
                <a href="../techniques/WebGL-Text-HTML.html">
            
                    
                    WebGL Text - HTML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../techniques/WebGL-Text-Canvas-2D.html">
            
                <a href="../techniques/WebGL-Text-Canvas-2D.html">
            
                    
                    WebGL Text - Canvas 2D
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../techniques/WebGL-Text-Using-a-Texture.html">
            
                <a href="../techniques/WebGL-Text-Using-a-Texture.html">
            
                    
                    WebGL Text - Using a Texture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../techniques/WebGL-Text-Using-a-Glyph-Texture.html">
            
                <a href="../techniques/WebGL-Text-Using-a-Glyph-Texture.html">
            
                    
                    WebGL Text - Using a Glyph Texture
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../misc/">
            
                <a href="../misc/">
            
                    
                    Misc
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../misc/WebGL-Boilerplate.html">
            
                <a href="../misc/WebGL-Boilerplate.html">
            
                    
                    WebGL Boilerplate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../misc/WebGL-Resizing-the-Canvas.html">
            
                <a href="../misc/WebGL-Resizing-the-Canvas.html">
            
                    
                    WebGL Resizing the Canvas
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../misc/WebGL-Animation.html">
            
                <a href="../misc/WebGL-Animation.html">
            
                    
                    WebGL - Animation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../misc/WebGL-3D-Textures.html">
            
                <a href="../misc/WebGL-3D-Textures.html">
            
                    
                    WebGL 3D - Textures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../misc/WebGL-Using-2-or-More-Textures.html">
            
                <a href="../misc/WebGL-Using-2-or-More-Textures.html">
            
                    
                    WebGL Using 2 or More Textures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../misc/WebGL-and-Alpha.html">
            
                <a href="../misc/WebGL-and-Alpha.html">
            
                    
                    WebGL and Alpha
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../misc/WebGL-2D-vs-3D-libraries.html">
            
                <a href="../misc/WebGL-2D-vs-3D-libraries.html">
            
                    
                    WebGL - 2D vs 3D libraries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../misc/WebGL-Anti-Patterns.html">
            
                <a href="../misc/WebGL-Anti-Patterns.html">
            
                    
                    WebGL - Anti-Patterns
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../Helper-API-Docs/">
            
                <a href="../Helper-API-Docs/">
            
                    
                    Helper API Docs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../TWGL-A-tiny-WebGL-helper-library/">
            
                <a href="../TWGL-A-tiny-WebGL-helper-library/">
            
                    
                    TWGL, A tiny WebGL helper library
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../术语/">
            
                <a href="../术语/">
            
                    
                    术语
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" >
            
                <a target="_blank" href="https://github.com/greggman/webgl-fundamentals">
            
                    
                    github
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >WebGL How It Works</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="webgl-how-it-works">WebGL How It Works</h1><h1 id="webgl-&#x5DE5;&#x4F5C;&#x539F;&#x7406;">WebGL &#x5DE5;&#x4F5C;&#x539F;&#x7406;</h1><p>This is a continuation from WebGL Fundamentals&#x3002;Before we continue I think we need to discuss at a basic level what WebGL and your GPU actually do&#x3002;There are basically 2 parts to this GPU thing&#x3002;The first part processes vertices (or streams of data) into clipspace vertices&#x3002;The second part draws pixels based on the first part.</p><p>&#x4E0A;&#x4E00;&#x8282;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x8BB2;&#x89E3;&#x4E86;<a href="http://webglfundamentals.org/webgl/lessons/webgl-fundamentals.html" target="_blank">WebGL &#x7684;&#x57FA;&#x7840;</a>&#x3002;&#x5728;&#x5F00;&#x59CB;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;WebGL &#x548C;&#x4F60;&#x7684; GPU &#x5E95;&#x5C42;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x3002;GPU &#x4E3B;&#x8981;&#x505A;&#x4E86;&#x4E24;&#x4EF6;&#x4E8B;&#x3002;&#x7B2C;&#x4E00;&#x4E2A;&#x662F;&#x8F6C;&#x6362;&#x9876;&#x70B9;(&#x6216;&#x8005;&#x8BF4; &#x6570;&#x636E;&#x6D41;)&#x5230;&#x88C1;&#x526A;&#x5E73;&#x9762;&#x4E2D;&#x3002;&#x7B2C;&#x4E8C;&#x4E2A;&#x5C31;&#x662F;&#x57FA;&#x4E8E;&#x524D;&#x4E00;&#x90E8;&#x5206;&#x6765;&#x6E32;&#x67D3;&#x56FE;&#x50CF;&#x3002;</p><p>When you call</p><p>&#x5F53;&#x4F60;&#x8C03;&#x7528;:</p><pre><code>gl.drawArrays(gl.TRIANGLE, 0, 9);</code></pre>
<p>The 9 there means &quot;process 9 vertices&quot; so here are 9 vertices being processed&#x3002;</p><p>&#x540E;&#x9762;&#x7684; 9 &#x4EE3;&#x8868;&#x7740;&#x201C;&#x5904;&#x7406;9&#x4E2A;&#x70B9;&#x201D;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x6709;9&#x4E2A;&#x70B9;&#x88AB;&#x5904;&#x7406;&#x4E86;&#x3002;</p><p><img src="http://webglfundamentals.org/webgl/lessons/resources/vertex-shader-anim.gif"></p><p>On the left is the data you provide&#x3002;The vertex shader is a function you write in GLSL&#x3002;It gets called once for each vertex&#x3002;You do some math and set the special variable gl_Position with a clipspace value for the current vertex&#x3002;The GPU takes that value and stores it internally.</p><p>&#x5DE6;&#x8FB9;&#x662F;&#x4F60;&#x63D0;&#x4F9B;&#x7684;&#x6570;&#x636E;&#xFF0C;vertex shader &#x662F;&#x4F60;&#x7528; <a href="http://webglfundamentals.org/webgl/lessons/webgl-shaders-and-glsl.html" target="_blank">GLSL</a> &#x5199;&#x51FA;&#x6765;&#x7684;&#x51FD;&#x6570;&#x3002;&#x5B83;&#x4F1A;&#x5728;&#x6BCF;&#x4E2A;&#x9876;&#x70B9;&#x88AB;&#x5904;&#x7406;&#x65F6;&#x8C03;&#x7528;&#x3002;&#x8BE5;&#x70B9;&#x7684;&#x503C;&#x7ECF;&#x8FC7;&#x76F8;&#x5E94;&#x7684;&#x6570;&#x5B66;&#x8FD0;&#x7B97;&#xFF0C;&#x8F6C;&#x6362;&#x6210;&#x4E3A;&#x88C1;&#x526A;&#x5750;&#x6807;&#x7684;&#x503C;&#xFF0C;&#x5E76;&#x4E14;&#x8D4B;&#x503C;&#x7ED9;&#x7279;&#x6B8A;&#x7684;&#x53D8;&#x91CF; <code>gl_Position</code>&#x3002;GPU &#x4F1A;&#x83B7;&#x5F97;&#x8BE5;&#x503C;&#x5E76;&#x4FDD;&#x5B58;&#x3002;</p><p>Assuming you&apos;re drawing TRIANGLES&#xFF0C;every time this first part generates 3 vertices the GPU uses them to make a triangle&#x3002;It figures out which pixels the 3 points of the triangle correspond to&#xFF0C;and then rasterizes the triangle which is a fancy word for &#x201C;draws it with pixels&#x201D;&#x3002;For each pixel it will call your fragment shader asking you what color to make that pixel&#x3002;Your fragment shader has to set a special variable gl_FragColor with the color it wants for that pixel.</p><p>&#x5F53;&#x4F60;&#x5728;&#x753B;&#x4E09;&#x89D2;&#x5F62;&#x65F6;&#xFF0C;&#x524D;&#x4E00;&#x4E2A;&#x90E8;&#x5206;&#x6BCF;&#x6B21;&#x4F1A;&#x6E32;&#x67D3;&#x51FA;3&#x4E2A;&#x70B9;&#xFF0C;GPU &#x5C31;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x8FD9;3&#x4E2A;&#x70B9;&#x53BB;&#x753B;&#x4E00;&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#x3002;GPU &#x4F1A;&#x627E;&#x5230;&#x8FD9;3&#x4E2A;&#x70B9;&#x5728;&#x56FE;&#x4E0A;&#x5BF9;&#x5E94;&#x7740;&#x7684;&#x50CF;&#x7D20;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x6E32;&#x67D3;&#x51FA;&#x4E00;&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#x3002;&#x63A5;&#x7740;&#xFF0C;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x50CF;&#x7D20;&#x70B9;&#xFF0C;GPU &#x4F1A;&#x8C03;&#x7528;&#x4F60;&#x7684; fragment shader&#xFF0C;&#x7ED9;&#x76F8;&#x5E94;&#x7684;&#x70B9;&#x52A0;&#x4E0A;&#x989C;&#x8272;&#x3002;fragment shader &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x901A;&#x8FC7; gl_FragColor &#x7ED9;&#x6BCF;&#x4E2A;&#x50CF;&#x7D20;&#x70B9;&#x8BBE;&#x7F6E;&#x989C;&#x8272;&#x3002;</p><p>That&#x2019;s all very interesting but as you can see in our examples to up this point the fragment shader has very little info per pixel&#x3002;Fortunately we can pass it more info&#x3002;We define &#x201C;varyings&#x201D; for each value we want to pass from the vertex shader to the fragment shader.</p><p>&#x4E0D;&#x8FC7;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;fragment shader &#x5E76;&#x6CA1;&#x6709;&#x533A;&#x5206;&#x6BCF;&#x4E00;&#x4E2A;&#x70B9;&#x7684;&#x989C;&#x8272;&#x503C;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x529E;&#x6CD5;&#x662F;&#x6709;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49; &#x201C;varyings&#x201D; &#x5C06;&#x6BCF;&#x4E00;&#x4E2A;&#x989C;&#x8272;&#x503C;&#x901A;&#x8FC7; vertex shader &#x8D4B;&#x7ED9; fragment shader&#x3002;</p><p>As a simple example&#xFF0C;let&apos;s just pass the clipspace coordinates we computed directly from the vertex shader to the fragment shader.</p><p>&#x770B;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4ECE; vertex shader &#x8BA1;&#x7B97;&#x51FA;&#x7684;&#x88C1;&#x526A;&#x5750;&#x6807;&#x503C;&#x4F20;&#x9012;&#x7ED9; fragment shader&#x3002;</p><p>We&apos;ll draw with a simple triangle&#x3002;Continuing from our previous example let&apos;s change our F to a triangle.</p><p>&#x7136;&#x540E;&#xFF0C;&#x753B;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4E09;&#x89D2;&#x5F62;&#x3002;&#x6211;&#x4EEC;&#x4FEE;&#x6539;<a href="http://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html" target="_blank">&#x524D;&#x9762;&#x7684;&#x4F8B;&#x5B50;</a>&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5C06;&#x753B; <code>F</code> &#x6539;&#x4E3A;&#x753B;&#x4E00;&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#x3002;</p><pre><code>// &#x5C06;&#x4E09;&#x89D2;&#x5F62;&#x7684;&#x50CF;&#x7D20;&#x503C;&#x5B58;&#x50A8;&#x5728; buffer &#x4E2D;
function setGeometry(gl) {
  gl.bufferData(
      gl.ARRAY_BUFFER,
      new Float32Array([
             0&#xFF0C;-100,
           150&#xFF0C; 125,
          -175&#xFF0C; 100]),
      gl.STATIC_DRAW);
}</code></pre>
<p>And we have to only draw 3 vertices.</p><p>&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x753B;&#x4E09;&#x4E2A;&#x70B9;:</p><pre><code>// &#x753B;&#x573A;&#x666F;
function drawScene() {
  ...
  // &#x753B;&#x51E0;&#x4F55;&#x56FE;&#x5F62;
  gl.drawArrays(gl.TRIANGLES&#xFF0C;0&#xFF0C;3);
}</code></pre>
<p>Then in our vertex shader we declare a varying to pass data to the fragment shader.</p><p>&#x5728; vertex shader &#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x58F0;&#x660E;&#x4E00;&#x4E2A; <code>varying</code> &#x5C06;&#x6570;&#x636E;&#x4F20;&#x9012;&#x7ED9; fragment shader&#x3002;</p><pre><code>varying vec4 v_color;
...
void main() {
  // &#x4F7F;&#x7528; matrix &#x4E58;&#x4EE5;&#x8BE5;&#x4F4D;&#x7F6E;
  gl_Position = vec4((u_matrix * vec3(a_position&#xFF0C;1)).xy&#xFF0C;0&#xFF0C;1);

  // &#x4ECE; &#x88C1;&#x526A;&#x7A7A;&#x95F4;&#x503C; &#x8F6C;&#x6362;&#x4E3A; &#x989C;&#x8272;&#x7A7A;&#x95F4;&#x503C;
  // &#x88C1;&#x526A;&#x7A7A;&#x95F4;&#x503C;&#x7684;&#x8303;&#x56F4;&#x4E3A; -1.0 &#x5230; +1.0
  // &#x989C;&#x8272;&#x7A7A;&#x95F4;&#x7684;&#x503C;&#x4ECE; 0.0 &#x5230; 1.0
  v_color = gl_Position * 0.5 + 0.5;
}</code></pre>
<p>And then we declare the same varying in the fragment shader.</p><p>&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5728; fragment shader &#x4E2D;&#xFF0C;&#x58F0;&#x660E;&#x4E00;&#x4E2A;&#x4E00;&#x6837;&#x7684; <code>varying</code>&#x3002;</p><pre><code>precision mediump float;

varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}</code></pre>
<p>WebGL will connect the varying in the vertex shader to the varying of the same name and type in the fragment shader.</p><p>WebGL &#x4F1A;&#x81EA;&#x52A8;&#x5173;&#x8054;&#x5728; vertex shader &#x548C; fragment shader &#x5B58;&#x5728;&#x7684;&#x540C;&#x540D; varying&#x3002;</p><p>Here&apos;s the working version.</p><p>&#x5177;&#x4F53;&#x6548;&#x679C;&#xFF0C;&#x53EF;&#x4EE5;<a href="http://webglfundamentals.org/webgl/webgl-2d-triangle-with-position-for-color.html" target="_blank">&#x67E5;&#x770B;&#x7F51;&#x9875;</a>&#x3002;</p><p><img src="http://static.zybuluo.com/jimmythr/b8vlmbiy0lznx53xb83m0xu8/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-09-25%2019.25.05.png"></p><p>Move&#xFF0C;scale and rotate the rectangle&#x3002;Notice that since the colors are computed from clipspace they don&apos;t move with the rectangle&#x3002;They are relative to the background.</p><p>&#x4E0A;&#x9762;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x79FB;&#x52A8;&#xFF0C;&#x7F29;&#x653E;&#x5E76;&#x4E14;&#x65CB;&#x8F6C;&#x8BE5;&#x4E09;&#x89D2;&#x5F62;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x989C;&#x8272;&#x662F;&#x76F4;&#x63A5;&#x6839;&#x636E;&#x88C1;&#x526A;&#x7A7A;&#x95F4;&#x6765;&#x7684;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6839;&#x636E;&#x4E09;&#x89D2;&#x5F62;&#x4E0A;&#x7684;&#x70B9;&#x6765;&#x7684;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x4ED6;&#x4EEC;&#x4E0D;&#x4F1A;&#x968F;&#x4E09;&#x89D2;&#x5F62;&#x4E00;&#x8D77;&#x79FB;&#x52A8;&#xFF0C;&#x800C;&#x662F;&#x56FA;&#x5B9A;&#x5728;&#x80CC;&#x666F;&#x4E2D;&#x3002;</p><p>Now think about it&#x3002;We only compute 3 vertices&#x3002;Our vertex shader only gets called 3 times therefore it&apos;s only computing 3 colors yet our triangle is many colors&#x3002;This is why it&apos;s called a varying.</p><p>&#x60F3;&#x4E00;&#x60F3;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x8BA1;&#x7B97;&#x4E86;3&#x4E2A;&#x70B9;&#x3002;&#x6240;&#x4EE5;&#xFF0C;vertex shader &#x4E5F;&#x53EA;&#x4F1A;&#x8C03;&#x7528;3&#x6B21;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EA;&#x80FD;&#x5F97;&#x51FA;3&#x79CD;&#x989C;&#x8272;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x4E09;&#x89D2;&#x5F62;&#x5374;&#x6709;&#x5F88;&#x591A;&#x989C;&#x8272;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E2A; varying&#x3002;</p><p>In the example above we start out with the 3 vertices</p><p>&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8BBE;&#x7F6E;&#x4E86;3&#x4E2A;&#x70B9;:</p><p><img src="http://static.zybuluo.com/jimmythr/adw0jtqkxsnz4uvpa267qjlr/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-09-24%2010.17.12.png"></p><p>Our vertex shader applies a matrix to translate&#xFF0C;rotate&#xFF0C;scale and convert to clipspace&#x3002;The defaults for translation&#xFF0C;rotation and scale are translation = 200&#xFF0C;150&#xFF0C;rotation = 0&#xFF0C;scale = 1,1 so that&apos;s really only translation&#x3002;Given our backbuffer is 400x300 our vertex shader applies the matrix and then computes the following 3 clipspace vertices.</p><p>&#x6211;&#x4EEC;&#x7684; vertex shader &#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x6A21;&#x578B;&#x53BB;&#x79FB;&#x52A8;,&#x65CB;&#x8F6C;,&#x653E;&#x7F29; &#x5E76;&#x4E14;&#x8F6C;&#x5316;&#x4E3A; &#x88C1;&#x526A;&#x5750;&#x6807;&#x7684;&#x503C;&#x3002;&#x4E0A;&#x8FF0;&#x53D8;&#x5316;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x5206;&#x522B;&#x662F;&#xFF1A;</p><ul><li>&#x5E73;&#x79FB;&#x4E3A; 200,150
</li>
<li>&#x65CB;&#x8F6C;&#x4E3A; 0
</li>
<li>&#x653E;&#x7F29;&#x4E3A; 1,1
</li></ul>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x53EA;&#x6709;&#x5E73;&#x79FB;&#x6709;&#x70B9;&#x4E0D;&#x540C;&#x3002;&#x524D;&#x9762;&#x7ED9;&#x51FA;&#x7684; backbuffer &#x662F; 400&#xD7;300&#xFF0C;&#x6211;&#x4EEC;&#x7684;vertex shader &#x4F1A;&#x5C06;&#x5176;&#x4F20;&#x9012;&#x7ED9;&#x6A21;&#x578B;&#xFF0C;&#x7136;&#x540E;&#x8BA1;&#x7B97;&#x51FA;&#x4E0B;&#x9762;3&#x4E2A;&#x88C1;&#x526A;&#x5750;&#x6807;&#x3002;</p><p><img src="http://static.zybuluo.com/jimmythr/sauoxvxpqladbt4jz8nvz17g/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-09-24%2010.17.56.png"></p><p>It also converts those to colorspace and writes them to the varying v_color that we declared.</p><p>&#x5B83;&#x540C;&#x6837;&#x4F1A;&#x8F6C;&#x6362;&#x4E0A;&#x8FF0;&#x503C;&#x5230;&#x989C;&#x8272;&#x7A7A;&#x95F4;&#xFF0C;&#x5E76;&#x4E14;&#x8D4B;&#x503C;&#x7ED9;&#x6211;&#x4EEC;&#x521A;&#x624D;&#x58F0;&#x660E;&#x7684; varying v_color &#x53D8;&#x91CF;&#x4E2D;&#x3002;</p><p><img src="http://static.zybuluo.com/jimmythr/pbbjikfwyyt4n6phle3ffyvr/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-09-24%2010.18.34.png"></p><p>Those 3 values written to v_color are then interpolated and passed to the fragment shader for each pixel.</p><p>&#x8FD9;&#x4E09;&#x4E2A;&#x503C;&#x88AB;&#x5199;&#x5165; v_color &#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x6DFB;&#x52A0;&#x5E76;&#x4E14;&#x4F20;&#x9012;&#x7ED9; fragment shader &#x53BB;&#x6E32;&#x67D3;&#x6BCF;&#x4E2A;&#x70B9;&#x7684;&#x989C;&#x8272;&#x3002;v_color &#x4F1A;&#x63D2;&#x5165;&#x5728; v0,v1&#x548C;v2 &#x4E4B;&#x95F4;&#x3002;</p><p>&#x6574;&#x4E2A;&#x6E32;&#x67D3;&#x8FC7;&#x7A0B;,&#x53EF;&#x4EE5;<a href="http://webglfundamentals.org/webgl/lessons/resources/fragment-shader-anim.html" target="_blank">&#x67E5;&#x770B;&#x5177;&#x4F53;&#x7F51;&#x9875;</a>.</p><p><img src="http://static.zybuluo.com/jimmythr/b79tktap4oxyq449uytkjblu/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-09-25%2019.28.18.png"></p><p>We can also pass in more data to the vertex shader which we can then pass on to the fragment shader&#x3002;So for example let&apos;s draw a rectangle&#xFF0C;that consists of 2 triangles&#xFF0C;in 2 colors&#x3002;To do this we&apos;ll add another attribute to the vertex shader so we can pass it more data and we&apos;ll pass that data directly to the fragment shader.</p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F20;&#x9012;&#x66F4;&#x591A;&#x7684;&#x6570;&#x636E;&#x7ED9; vertex shader&#xFF0C;&#x540C;&#x6837;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F20;&#x9012;&#x7ED9; fragment shader&#x3002; &#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x753B;&#x4E00;&#x4E2A;&#x77E9;&#x5F62;&#xFF0C;&#x5C31;&#x9700;&#x8981; 2 &#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#xFF0C;2&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x989C;&#x8272;&#x3002;&#x5728; vertex shader &#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x53E6;&#x5916;&#x4E00;&#x4E2A; attribute &#x53BB;&#x4F20;&#x9012;&#x66F4;&#x591A;&#x7684;&#x6570;&#x636E;&#x3002;&#x90A3;&#x4E48; fragment shader &#x4E5F;&#x4F1A;&#x5904;&#x7406;&#x66F4;&#x591A;&#x7684;&#x6570;&#x636E;&#x3002;</p><pre><code>attribute vec2 a_position;
attribute vec4 a_color;
...
varying vec4 v_color;

void main() {
   ...
  // &#x628A; attribute &#x4E2D;&#x7684;&#x989C;&#x8272;&#x503C;&#x590D;&#x5236;&#x5230; varying &#x4E2D;
  v_color = a_color;
}</code></pre>
<p>We now have to supply colors for WebGL to use.</p><p>&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x5411; WebGL &#x63D0;&#x4F9B;&#x9700;&#x8981;&#x7528;&#x5230;&#x7684;&#x989C;&#x8272;&#x3002;</p><pre><code>  // &#x627E;&#x5230; vertex data &#x7ED1;&#x5B9A;&#x7684;&#x4F4D;&#x7F6E;
  var positionLocation = gl.getAttribLocation(program&#xFF0C;&quot;a_position&quot;);
  var colorLocation = gl.getAttribLocation(program&#xFF0C;&quot;a_color&quot;);
  ...
  // &#x521B;&#x5EFA;&#x4E00;&#x4E2A; buffer &#x53BB;&#x52A0;&#x8F7D;&#x989C;&#x8272;&#x503C;
  var buffer = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER&#xFF0C;buffer);
  gl.enableVertexAttribArray(colorLocation);
  gl.vertexAttribPointer(colorLocation&#xFF0C;4&#xFF0C;gl.FLOAT&#xFF0C;false&#xFF0C;0&#xFF0C;0);

  // &#x8BBE;&#x7F6E;&#x989C;&#x8272;&#x503C;
  setColors(gl);
  ...

// &#x7ED9; buffer &#x586B;&#x5145;2&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#x9700;&#x8981;&#x7528;&#x5230;&#x7684;&#x989C;&#x8272;&#x503C;
function setColors(gl) {
  // &#x968F;&#x673A;&#x9009;&#x53D6;2&#x79CD;&#x989C;&#x8272;
  var r1 = Math.random();
  var b1 = Math.random();
  var g1 = Math.random();

  var r2 = Math.random();
  var b2 = Math.random();
  var g2 = Math.random();

  gl.bufferData(
      gl.ARRAY_BUFFER,
      new Float32Array(
        [ r1,b1,g1,1,
          r1,b1,g1,1,
          r1,b1,g1,1,
          r2,b2,g2,1,
          r2,b2,g2,1,
          r2,b2,g2,1]),
      gl.STATIC_DRAW);
}</code></pre>
<p><a href="http://webglfundamentals.org/webgl/webgl-2d-rectangle-with-2-colors.html" target="_blank">&#x6700;&#x7EC8;&#x7684;&#x7ED3;&#x679C;</a>.</p><p><img src="http://static.zybuluo.com/jimmythr/thbg545hxy5sfvy16ay1080j/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-09-25%2019.29.32.png"></p><p>Notice that we have 2 solid color triangles&#x3002;Yet we&apos;re passing the values in a varying so they are being varied or interpolated across the triangle&#x3002;It&apos;s just that we used the same color on each of the 3 vertices of each triangle&#x3002;If we make each color different we&apos;ll see the interpolation.</p><p>&#x6CE8;&#x610F;&#xFF0C;&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x4E24;&#x4E2A;&#x56FA;&#x5B9A;&#x7684;&#x989C;&#x8272;&#x503C;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x662F;&#x5C06;&#x503C;&#x8D4B;&#x7ED9; varying&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x4E09;&#x89D2;&#x5F62;&#x4E2D;&#x7684;&#x989C;&#x8272;&#x503C;&#x662F;&#x53EF;&#x4EE5;&#x53D8;&#x5316;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x4E0A;&#x9762;&#x7ED9;&#x6BCF;&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#x7684;3&#x4E2A;&#x70B9;&#x8BBE;&#x7F6E;&#x7684;&#x662F;&#x76F8;&#x540C;&#x7684;&#x989C;&#x8272;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8BBE;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x503C;&#xFF0C;&#x5C06;&#x4F1A;&#x770B;&#x5230;&#x5177;&#x4F53;&#x7684;&#x5DEE;&#x503C;&#x3002;</p><pre><code>// &#x7ED9; buffer &#x586B;&#x5145;2&#x4E2A;&#x4E09;&#x89D2;&#x5F62;&#x9700;&#x8981;&#x7528;&#x5230;&#x7684;&#x989C;&#x8272;&#x503C;
function setColors(gl) {
  // &#x7ED9;&#x6BCF;&#x4E2A;&#x9876;&#x70B9;&#x8BBE;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x989C;&#x8272;
  gl.bufferData(
      gl.ARRAY_BUFFER,
      new Float32Array(
        [ Math.random(),Math.random(),Math.random(),1,
          Math.random(),Math.random(),Math.random(),1,
          Math.random(),Math.random(),Math.random(),1,
          Math.random(),Math.random(),Math.random(),1,
          Math.random(),Math.random(),Math.random(),1,
          Math.random(),Math.random(),Math.random(),1]),
      gl.STATIC_DRAW);
}</code></pre>
<p>&#x73B0;&#x5728;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x770B;&#x89C1;<a href="http://webglfundamentals.org/webgl/webgl-2d-rectangle-with-random-colors.html" target="_blank">&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x5730;&#x65B9;</a>&#x3002;</p><p><img src="http://static.zybuluo.com/jimmythr/54juuw1l3lw5myhc9t258fgt/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-09-25%2019.30.25.png"></p><p>Not very exciting I suppose but it does demonstrate using more than one attribute and passing data from a vertex shader to a fragment shader&#x3002;If you check out the image processing examples you&apos;ll see they also use an extra attribute to pass in texture coordinates.</p><p>&#x770B;&#x8D77;&#x6765;&#x548C;&#x7B2C;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x4E86;&#x89E3;&#x4E86;&#x4F7F;&#x7528;&#x66F4;&#x591A;&#x7684; attribute &#x5C06;&#x6570;&#x636E;&#x7531; vertex shader &#x4F20;&#x9012;&#x7ED9; fragment shader&#x3002;&#x5982;&#x679C;&#x4F60;&#x770B;&#x4E86;<a href="http://webglfundamentals.org/webgl/lessons/webgl-image-processing.html" target="_blank">&#x56FE;&#x50CF;&#x5904;&#x7406;&#x7684;&#x4F8B;&#x5B50;</a>&#x7684;&#x8BDD;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x90A3;&#x91CC;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x7684; attribute &#x53BB;&#x4F20;&#x9012;&#x7EB9;&#x7406;&#x5750;&#x6807;&#x3002;</p><h2 id="buffer-&#x548C;-attribute-&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#xFF1F;">buffer &#x548C; attribute &#x505A;&#x4E86;&#x4EC0;&#x4E48;&#xFF1F;</h2><p>Buffers are the way of getting vertex and other per vertex data onto the GPU. gl.createBuffer creates a buffer. gl.bindBuffer sets that buffer as the buffer to be worked on. gl.bufferData copies data into the buffer.</p><p>Buffers &#x7528;&#x6765;&#x83B7;&#x53D6;&#x9876;&#x70B9;&#x548C;&#x5176;&#x4ED6;&#x70B9;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4F20;&#x8F93;&#x7ED9; CPU&#x3002; <code>gl.createBuffer</code> &#x521B;&#x5EFA;&#x4E00;&#x4E2A; buffer&#x3002; <code>gl.bindBuffer</code> &#x7ED1;&#x5B9A;&#x9700;&#x8981;&#x5904;&#x7406;&#x7684; buffer&#x3002;<code>gl.bufferData</code> &#x5C06;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;&#x6307;&#x5B9A;&#x7684; buffer&#x3002;</p><p>Once the data is in the buffer we need to tell WebGL how to get data out of it and provide it to the vertex shader&apos;s attributes.</p><p>&#x4E00;&#x65E6;&#x6570;&#x636E;&#x5728; buffer &#x4E2D;&#x51C6;&#x5907;&#x597D;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x544A;&#x8BC9; WebGL &#x5982;&#x4F55;&#x5C06;&#x6570;&#x636E;&#x63D0;&#x53D6;&#x51FA;&#x6765;&#x5E76;&#x4E14;&#x4F20;&#x9012;&#x7ED9; vertex shader&apos;s attributes&#x3002;</p><p>To do this, first we ask WebGL what locations it assigned to the attributes. For example in the code above we have</p><p>&#x4E3A;&#x4E86;&#x5B8C;&#x6210;&#x4E0A;&#x8FF0;&#x8FC7;&#x7A0B;&#xFF0C;&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x8981;&#x4E86;&#x89E3; WebGL &#x628A;&#x54EA;&#x4E9B;&#x4F4D;&#x7F6E;&#x8D4B;&#x503C;&#x7ED9;&#x4E86; attributes&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;:</p><pre><code>// &#x89E3;&#x6790; vertex &#x6570;&#x636E;&#x7684;&#x6D41;&#x5411;
var positionLocation = gl.getAttribLocation(program,&quot;a_position&quot;);
var colorLocation = gl.getAttribLocation(program,&quot;a_color&quot;);</code></pre>
<p>Once we know the location of the attribute we then issue 2 commands&#x3002;</p><p>&#x4E00;&#x65E6;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x4E86; attribute &#x7684;&#x76F8;&#x5173;&#x4F4D;&#x7F6E;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x8C03;&#x7528;2&#x4E2A;&#x547D;&#x4EE4;&#x3002;</p><pre><code>gl.enableVertexAttribArray(location);</code></pre>
<p>This command tells WebGL we want to supply data from a buffer.</p><p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x544A;&#x8BC9; WebGL&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7; buffer &#x63D0;&#x4F9B;&#x7684;&#x6570;&#x636E;&#x3002;</p><pre><code>gl.vertexAttribPointer(
    location,
    numComponents,
    typeOfData,
    normalizeFlag,
    strideToNextPieceOfData,
    offsetIntoBuffer);</code></pre>
<p>And this command tells WebGL to get data from the buffer that was last bound with gl.bindBuffer, how many components per vertex (1 - 4), what the type of data is (BYTE, FLOAT, INT, UNSIGNED_SHORT, etc...), the stride which means how many bytes to skip to get from one piece of data to the next piece of data, and an offset for how far into the buffer our data is.</p><p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x8BA9; WebGL &#x4ECE;&#x521A;&#x624D;&#x901A;&#x8FC7; <code>gl.bindBuffer</code> &#x7ED1;&#x5B9A;&#x7684; buffer &#x4E2D;&#x63D0;&#x53D6;&#x6570;&#x636E;&#x3002;&#x8BE5; buffer &#x5305;&#x542B;&#x4E86;&#x6BCF;&#x4E2A;&#x9876;&#x70B9;&#x7684;&#x7EC4;&#x6210;&#x90E8;&#x5206;(1 - 4)&#xFF0C;&#x5177;&#x4F53;&#x6570;&#x636E;&#x7684;&#x7C7B;&#x578B;&#x662F;&#x4EC0;&#x4E48; (BYTE, FLOAT, INT, UNSIGNED_SHORT &#x7B49;&#x7B49;)&#xFF0C;&#x6BCF;&#x4E2A;&#x6709;&#x6548;&#x6570;&#x636E;&#x4E4B;&#x95F4;&#x7684;&#x6B65;&#x957F;&#x662F;&#x591A;&#x5C11;&#xFF0C;&#x771F;&#x5B9E;&#x6570;&#x636E;&#x5728; buffer &#x4E2D;&#x7684;&#x504F;&#x79FB;&#x91CF;&#x662F;&#x591A;&#x5C11;&#x3002;</p><p>Number of components is always 1 to 4.</p><p>&#x7EC4;&#x6210;&#x6BCF;&#x4E2A;&#x9876;&#x70B9;&#x7684;&#x6570;&#x636E;&#x957F;&#x5EA6;&#x4E00;&#x822C;&#x90FD;&#x662F; 1 &#x5230; 4&#x3002;</p><p>If you are using 1 buffer per type of data then both stride and offset can always be 0. 0 for stride means &quot;use a stride that matches the type and size&quot;. 0 for offset means start at the beginning of the buffer. Setting them to values other than 0 is more complicated and though it has some benefits in terms of performance it&apos;s not worth the complication unless you are trying to push WebGL to its absolute limits.</p><p>&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x5355;&#x4F4D;&#x5927;&#x5C0F;&#x7684; buffer &#x7684;&#x5355;&#x4E00;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x6B65;&#x957F;&#x548C;&#x504F;&#x79FB;&#x91CF;&#x603B;&#x662F; 0&#x3002;&#x6B65;&#x957F;&#x4E3A; 0 &#x610F;&#x5473;&#x7740; &#x201C;&#x6BCF;&#x4E2A;&#x6B65;&#x957F;&#x5305;&#x62EC;&#x4E86;&#x6570;&#x636E;&#x7684;&#x7C7B;&#x578B;&#x548C;&#x5927;&#x5C0F;&#x201D;&#x3002;&#x504F;&#x79FB;&#x91CF;&#x4E3A; 0 &#x610F;&#x5473;&#x7740;&#x6570;&#x636E;&#x4ECE; buffer &#x7684;&#x8D77;&#x59CB;&#x4F4D;&#x5F00;&#x59CB;. &#x5C06;&#x4ED6;&#x4EEC;&#x8BBE;&#x7F6E;&#x4E3A;&#x5176;&#x4ED6;&#x503C;&#x800C;&#x4E0D;&#x662F; 0 &#x6765;&#x8BF4;, &#x4F1A;&#x66F4;&#x590D;&#x6742;&#xFF0C;&#x5C3D;&#x7BA1;&#x8FD9;&#x6837;&#x505A;&#x5728;&#x6027;&#x80FD;&#x65B9;&#x9762;&#x6709;&#x4E9B;&#x597D;&#x5904;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x76F8;&#x5BF9;&#x4E8E;&#x590D;&#x6742;&#x5EA6;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x5E76;&#x4E0D;&#x503C;&#x5F97;&#xFF0C;&#x9664;&#x975E;&#x4F60;&#x662F;&#x60F3;&#x8BA9; WebGL &#x53D7;&#x5B83;&#x7EDD;&#x5BF9;&#x7684;&#x9650;&#x5236;&#x3002;</p><p>I hope that clears up buffers and attributes.</p><p>&#x6211;&#x5E0C;&#x671B;&#x4E0A;&#x9762;&#x89E3;&#x51B3;&#x4E86; buffers &#x548C; attributes &#x600E;&#x6837;&#x5DE5;&#x4F5C;&#x7684;&#x95EE;&#x9898;&#x3002;</p><p>Next let&apos;s go over shaders and GLSL.</p><p>&#x4E0B;&#x9762;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x5B66;&#x4E60; <a href="http://webglfundamentals.org/webgl/lessons/webgl-shaders-and-glsl.html" target="_blank">shaders and GLSL</a>&#x3002;</p><hr><p><strong>&#x8865;&#x5145;</strong></p><h2 id="normalizeflag-&#x5728;-vertexattribpointer-&#x4E2D;&#x4EE3;&#x8868;&#x4EC0;&#x4E48;&#xFF1F;">normalizeFlag &#x5728; vertexAttribPointer &#x4E2D;&#x4EE3;&#x8868;&#x4EC0;&#x4E48;&#xFF1F;</h2><p>The normalize flag is for all the non floating point types. If you pass in false then values will be interpreted as the type they are. BYTE goes from -128 to 127, UNSIGNED_BYTE goes from 0 to 255, SHORT goes from -32768 to 32767 etc...</p><p>normalize flag &#x4E3B;&#x8981;&#x5F71;&#x54CD;&#x6240;&#x6709;&#x7684;&#x975E;&#x6D6E;&#x70B9;&#x7C7B;&#x578B;&#x3002; &#x5982;&#x679C;&#x4F60;&#x5C06;&#x5B83;&#x8BBE;&#x7F6E;&#x4E3A; false&#xFF0C; &#x90A3;&#x4E48;&#x7C7B;&#x578B;&#x7684;&#x503C;&#x8FD8;&#x662F;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#x3002;BYTE &#x7684;&#x5927;&#x5C0F;&#x8FD8;&#x662F;&#x4ECE; -128 &#x5230; 127&#xFF0C;UNSIGNED_BYTE &#x7684;&#x5927;&#x5C0F;&#x4ECE; 0 &#x5230; 255, SHORT &#x7684;&#x5927;&#x5C0F;&#x4ECE; -32768 &#x5230; 32767 &#x7B49;&#x7B49;&#x3002;</p><p>If you set the normalize flag to true then the values of a BYTE (-128 to 127) represent the values -1.0 to +1.0, UNSIGNED_BYTE (0 to 255) become 0.0 to +1.0. A normalized SHORT also goes from -1.0 to +1.0 it just has more resolution than a BYTE.</p><p>&#x5982;&#x679C; normalize flag &#x8BBE;&#x7F6E;&#x4E3A; true, &#x90A3;&#x4E48; BYTE (-128 &#x5230; 127) &#x7684;&#x5927;&#x5C0F;&#x53D8;&#x4E3A; -1.0 &#x5230; +1.0&#xFF0C;UNSIGNED_BYTE (0 &#x5230; 255) &#x7684;&#x5927;&#x5C0F;&#x53D8;&#x4E3A; 0.0 &#x5230; +1.0&#x3002; SHORT &#x7684;&#x5927;&#x5C0F;&#x548C; BYTE &#x4E00;&#x6837;&#x4E5F;&#x662F; -1.0 &#x5230; +1.0, &#x4E0D;&#x8FC7;&#x4ED6;&#x6BD4; BYTE &#x7684;&#x5206;&#x8FA8;&#x7387;&#x66F4;&#x9AD8;.</p><p>The most common use for normalized data is for colors. Most of the time colors only go from 0.0 to 1.0. Using a full float each for red, green, blue and alpha would use 16 bytes per vertex per color. If you have complicated geometry that can add up to a lot of bytes. Instead you could convert your colors to UNSIGNED_BYTEs where 0 represents 0.0 and 255 represents 1.0. Now you&apos;d only need 4 bytes per color per vertex, a 75% savings.</p><p>&#x5F52;&#x4E00;&#x5316;&#x6570;&#x636E;&#x6700;&#x5E38;&#x7528;&#x5728;&#x989C;&#x8272;&#x503C;&#x4E0A;&#x3002;&#x989C;&#x8272;&#x503C;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x662F;&#x4ECE; 0.0 &#x5230; 1.0&#x3002; &#x4F7F;&#x7528;&#x6D6E;&#x70B9;&#x6570;&#x53BB;&#x8868;&#x8FBE;&#x7EA2;&#x8272;&#xFF0C;&#x7EFF;&#x8272;&#xFF0C;&#x84DD;&#x8272;&#x548C;&#x900F;&#x660E;&#x5EA6;&#xFF0C;&#x6BCF;&#x4E2A;&#x9876;&#x70B9;&#x7684;&#x989C;&#x8272;&#x4F1A;&#x82B1;&#x6389; 16 bytes &#x7684;&#x5927;&#x5C0F;&#x3002;&#x5982;&#x679C;&#x4F60;&#x6709;&#x66F4;&#x590D;&#x6742;&#x7684;&#x51E0;&#x4F55;&#x56FE;&#x5F62;&#x7684;&#x8BDD;,&#x90A3;&#x7D2F;&#x79EF;&#x4E0B;&#x6765;&#x5C31;&#x5F88;&#x5927;&#x4E86;&#x3002;&#x5982;&#x679C;&#xFF0C;&#x4F60;&#x80FD;&#x7528; UNSIGNED_BYTEs &#x53BB;&#x8868;&#x8FBE;&#x4F60;&#x7684;&#x989C;&#x8272;&#x503C;&#xFF0C; &#x6BD4;&#x5982; 0 &#x4EE3;&#x8868; 0.0, 255 &#x4EE3;&#x8868; 1.0&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x4F60;&#x4EC5;&#x4EC5;&#x53EA;&#x9700;&#x8981; 4 bytes &#x53BB;&#x8868;&#x8FBE;&#x6BCF;&#x4E2A;&#x70B9;&#x7684;&#x989C;&#x8272;&#x503C;&#xFF0C;&#x8FD9;&#x8282;&#x7701;&#x4E86; 75% &#x7684;&#x5927;&#x5C0F;&#x3002;</p><p>Let&apos;s change our code to do this. When we tell WebGL how to extract our colors we&apos;d use</p><p>&#x6211;&#x4EEC;&#x6765;&#x6539;&#x5199;&#x4E00;&#x4E0B;&#x4EE3;&#x7801;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x544A;&#x8BC9; WebGL &#x600E;&#x6837;&#x53BB;&#x63D0;&#x53D6;&#x989C;&#x8272;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528;</p><pre><code>gl.vertexAttribPointer(colorLocation, 4, gl.UNSIGNED_BYTE, true, 0, 0);</code></pre>
<p>And when we fill out our buffer with colors we&apos;d use</p><p>&#x7136;&#x540E;, &#x5F53;&#x6211;&#x4EEC;&#x5C06;&#x989C;&#x8272;&#x503C;&#x586B;&#x5145;&#x5230; buffer &#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528;</p><pre><code>// &#x586B;&#x5145; 2 &#x4E2A;&#x4E09;&#x89D2;&#x989C;&#x8272;&#x503C;&#x5230; buffer &#x91CC;
function setColors(gl) {
  // &#x9009;&#x53D6; 2 &#x4E2A;&#x968F;&#x673A;&#x989C;&#x8272;
  var r1 = Math.random() * 256; // 0 to 255.99999
  var b1 = Math.random() * 256; // these values
  var g1 = Math.random() * 256; // will be truncated
  var r2 = Math.random() * 256; // when stored in the
  var b2 = Math.random() * 256; // Uint8Array
  var g2 = Math.random() * 256;

  gl.bufferData(
      gl.ARRAY_BUFFER,
      new Uint8Array(   // Uint8Array
        [ r1, b1, g1, 255,
          r1, b1, g1, 255,
          r1, b1, g1, 255,
          r2, b2, g2, 255,
          r2, b2, g2, 255,
          r2, b2, g2, 255]),
      gl.STATIC_DRAW);
}</code></pre>
<p>Here&apos;s that sample.
&#x4E0B;&#x9762;&#x662F;&#x4E2A;<a href="http://webglfundamentals.org/webgl/webgl-2d-rectangle-with-2-byte-colors.html" target="_blank">&#x5B9E;&#x4F8B;</a>&#x3002;</p><p><img src="http://static.zybuluo.com/jimmythr/a9gcqxzknnp7fnh54ht8qpa5/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-09-25%2023.33.00.png"></p><p>&#x6709;&#x95EE;&#x9898;? <a href="http://stackoverflow.com/questions/tagged/webgl" target="_blank">&#x5728; stack overflow &#x4E0A;&#x63D0;&#x95EE;</a>&#x3002;
Issue/Bug? <a href="http://github.com/greggman/webgl-fundamentals/issues" target="_blank">&#x5728; github &#x4E0A;&#x521B;&#x5EFA; issue</a>&#x3002;</p>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="WebGL-Fundamentals.html" class="navigation navigation-prev " aria-label="Previous page: WebGL Fundamentals">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="WebGL-Shaders-and-GLSL.html" class="navigation navigation-next " aria-label="Next page: WebGL Shaders and GLSL">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"WebGL How It Works","level":"1.2.2","depth":2,"next":{"title":"WebGL Shaders and GLSL","level":"1.2.3","depth":2,"path":"fundamentals/WebGL-Shaders-and-GLSL.md","ref":"fundamentals/WebGL-Shaders-and-GLSL.md","articles":[]},"previous":{"title":"WebGL Fundamentals","level":"1.2.1","depth":2,"path":"fundamentals/WebGL-Fundamentals.md","ref":"fundamentals/WebGL-Fundamentals.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"fundamentals/WebGL-How-It-Works.md","mtime":"2016-09-26T11:18:01.000Z","type":"markdown"},"gitbook":{"version":"3.2.0","time":"2016-09-26T11:18:20.514Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

